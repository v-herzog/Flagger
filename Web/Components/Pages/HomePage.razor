@using Flagger.Application.Entities
@using Flagger.Application.Interfaces
@using Flagger.Components.Pages.Home

@page "/"
@inject IGameService gameService

@if (game is not null)
{
    @if (game.State == GameStateEnum.START)
    {
        <Start OnStart="StartNewGame" />
    }
    @if (game.State == GameStateEnum.GUESS)
    {
        <Guess OnValidation=@(() => StateHasChanged()) />
    }
    @if (game.State == GameStateEnum.DETAILS)
    {
        <Details OnNext="ProcessNext" />
    }
    @if (game.State == GameStateEnum.FINISH)
    {
        <End OnNewGame="StartNewGame" />
    }
}

@code {
    private Game game;

    protected override void OnInitialized()
    {
        this.game = gameService.Get();
    }

    private async Task StartNewGame()
    {
        this.game = await gameService.Create();
    }

    private async void ProcessNext()
    {
        await gameService.SetupFlag();
    }
}